From b41f83d2c886939739c1b29ff2d6eb95cbdb4dc5 Mon Sep 17 00:00:00 2001
From: Jonas Dujava <jonas.dujava@gmail.com>
Date: Sun, 23 Jul 2023 18:27:37 +0200
Subject: [PATCH 1/2] fix undesirable restoring of the working directory

---
 autoload/floaterm/terminal.vim   | 10 +++++-----
 autoload/floaterm/wrapper/lf.vim |  6 +++---
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/autoload/floaterm/terminal.vim b/autoload/floaterm/terminal.vim
index fcbfb1a..62fee48 100644
--- a/autoload/floaterm/terminal.vim
+++ b/autoload/floaterm/terminal.vim
@@ -74,10 +74,10 @@ function! floaterm#terminal#open(bufnr, cmd, jobopts, config) abort
 
   if !bufexists(a:bufnr)
     " change cwd
-    let savedcwd = getcwd()
-    if has_key(a:config, 'cwd')
-      call floaterm#path#chdir(a:config.cwd)
-    endif
+    " let savedcwd = getcwd()
+    " if has_key(a:config, 'cwd')
+    "   call floaterm#path#chdir(a:config.cwd)
+    " endif
 
     " spawn terminal
     let bufnr = s:spawn_terminal(a:cmd, a:jobopts, a:config)
@@ -88,7 +88,7 @@ function! floaterm#terminal#open(bufnr, cmd, jobopts, config) abort
     endif
 
     " restore cwd
-    call floaterm#path#chdir(savedcwd)
+    " call floaterm#path#chdir(savedcwd)
   else
     let config = floaterm#config#parse(a:bufnr, a:config)
     call floaterm#window#open(a:bufnr, config)
diff --git a/autoload/floaterm/wrapper/lf.vim b/autoload/floaterm/wrapper/lf.vim
index 76cba23..79dbd7f 100644
--- a/autoload/floaterm/wrapper/lf.vim
+++ b/autoload/floaterm/wrapper/lf.vim
@@ -7,8 +7,8 @@
 
 function! floaterm#wrapper#lf#(cmd, jobopts, config) abort
   let s:lf_tmpfile = tempname()
-  let original_dir = getcwd()
-  lcd %:p:h
+  " let original_dir = getcwd()
+  " lcd %:p:h
 
   let cmdlist = split(a:cmd)
   let cmd = 'lf -selection-path="' . s:lf_tmpfile . '"'
@@ -24,7 +24,7 @@ function! floaterm#wrapper#lf#(cmd, jobopts, config) abort
     endif
   endif
 
-  exe "lcd " . original_dir
+  " exe "lcd " . original_dir
   let cmd = [&shell, &shellcmdflag, cmd]
   let jobopts = {'on_exit': funcref('s:lf_callback')}
   call floaterm#util#deep_extend(a:jobopts, jobopts)
-- 
2.41.0

